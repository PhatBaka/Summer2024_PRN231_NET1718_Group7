@page
@model JewelryStoreUI.Pages.Jewleries.CreateModel
@{
    Layout = "_ManagerLayout";
}

<style>
    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        padding: 8px;
        line-height: 1.42857143;
        vertical-align: middle;
        border-top: 1px solid #ddd
    }

    .wrap-text {
        word-wrap: break-word; /* IE */
        overflow-wrap: break-word; /* CSS3 */
        white-space: normal;
        max-width: 150px;
    }
</style>

<section id="center" class="center_shop">
    <div class="container">
        <div class="row">
            <div class="center_shop_t clearfix">
                <div class="col-sm-6">
                    <div class="center_shop_tl clearfix d-flex align-items-center">
                        <h4 class="mgt">NEW GEM</h4>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="center_shop_tr text-right clearfix">
                        <h6 class="col_2">You are here: <a asp-asp-page="Gems/Index">Home</a> / Gem</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <div class="cart_3 clearfix">
            <div class="col-sm-6">
                <div class="cart_3r clearfix">
                    <h5 class="mgt head_1">METAL</h5>
                </div>
                @{
                    var metals = Model.MetalCarts;
                    if (metals != null)
                    {
                        if (metals.Count() > 0)
                        {
                            @if (metals.FirstOrDefault(x => x.Name == "gold") != null)
                            {
                                <div class="cart_3l1 clearfix">
                                    <div class="col-sm-3 space_left">
                                        <div class="cart_3l1i clearfix">
                                            <a href="#"><img src="~/img/gold.jpg" alt="abc" class="iw"></a>
                                        </div>
                                    </div>
                                    <div class="col-sm-9">
                                        <div class="cart_3l1i1 clearfix">
                                            <h5 class="mgt">
                                                Gold
                                            </h5>
                                            <h4>@Model.GoldBid$</h4>
                                            <h5>Weight</h5>
                                        </div>
                                        <div class="cart_3l1i2 clearfix">
                                            <form asp-page-handler="AddMaterialToCart" method="post">
                                                <div class="input-group number-spinner">
                                                    <input name="GoldWeight" class="form-control text-center">
                                                    <input name="Metal" value="gold" type="hidden" />
                                                    <input name="Metal" value="@Model.GoldBid" type="hidden" />
                                                </div>
                                                <h6 class="mgt"><input class="button mgt" type="submit" value="UPDATE CART" /></h6>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                            @if (metals.FirstOrDefault(x => x.Name == "silver") != null)
                            {
                                <div class="cart_3l1 clearfix">
                                    <div class="col-sm-3 space_left">
                                        <div class="cart_3l1i clearfix">
                                            <a href="#"><img src="~/img/silver.jpg" width="100px" height="100px" alt="abc" class="iw"></a>
                                        </div>
                                    </div>
                                    <div class="col-sm-9">
                                        <div class="cart_3l1i1 clearfix">
                                            <h5 class="mgt">
                                                Silver
                                            </h5>
                                            <h4>@Model.SilverBid$</h4>
                                            <h5>Weight</h5>
                                        </div>
                                        <div class="cart_3l1i2 clearfix">
                                            <form asp-page-handler="AddMaterialToCart" method="post">
                                                <div class="input-group number-spinner">
                                                    <input name="SilverWeight" class="form-control text-center">
                                                    <input name="Metal" value="silver" type="hidden" />
                                                    <input name="Metal" value="@Model.SilverBid" type="hidden" />
                                                </div>
                                                <h6 class="mgt"><input class="button mgt" type="submit" value="UPDATE CART" /></h6>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                            @if (metals.FirstOrDefault(x => x.Name == "palladium") != null)
                            {
                                <div class="cart_3l1 clearfix">
                                    <div class="col-sm-3 space_left">
                                        <div class="cart_3l1i clearfix">
                                            <a href="#"><img src="~/img/palladium.jpg" alt="abc" class="iw"></a>
                                        </div>
                                    </div>
                                    <div class="col-sm-9">
                                        <div class="cart_3l1i1 clearfix">
                                            <h5 class="mgt">
                                                Palladium
                                            </h5>
                                            <h4>@Model.PalladiumBid$</h4>
                                            <h5>Weight</h5>
                                        </div>
                                        <div class="cart_3l1i2 clearfix">
                                            <form asp-page-handler="AddMaterialToCart" method="post">
                                                <div class="input-group number-spinner">
                                                    <input name="PalladiumWeight" class="form-control text-center">
                                                    <input name="Metal" value="palladium" type="hidden" />
                                                    <input name="Metal" value="@Model.PalladiumBid" type="hidden" />
                                                </div>
                                                <h6 class="mgt"><input class="button mgt" type="submit" value="UPDATE CART" /></h6>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    }
                    else
                    {
                        <p>You don't add any metal now</p>
                    }
                }
                <div class="cart_3r clearfix">
                    <h5 class="mgt head_1">MATERIAL</h5>
                </div>
                @{
                    var materials = Model.MaterialCarts;
                    if (materials != null)
                    {
                        var metalInCart = materials.Where(x => x.IsMetal == true);
                        var gemInCart = materials.Where(x => x.IsMetal == false);
                        if (gemInCart.Count() > 0)
                        {
                            foreach (var gem in gemInCart)
                            {
                                <form asp-page-handler="" method="post">
                                    <div class="cart_3l1 clearfix">
                                        <div class="col-sm-3 space_left">
                                            <div class="cart_3l1i clearfix">
                                                <a href="#"><img src="data:image/jpeg;base64,@Convert.ToBase64String(gem.MaterialImageData)" style="max-width: 150px; max-height: 150px" alt="@gem.Name" alt="abc" class="iw"></a>
                                            </div>
                                        </div>
                                        <div class="cart_3l1i1 clearfix">
                                            <h5 class="mgt">
                                                Name: @gem.Name
                                            </h5>
                                            <h5 class="mgt">
                                                Weight: @gem.Weight karat
                                            </h5>
                                            <h4>Sell Price: @gem.SellPrice.ToString("F2")</h4>
                                            <!-- <div class="cart_3l1i2 clearfix">
                                                <h6 class="mgt"><a class="button_1 mgt" href="#">REMOVE</a></h6>
                                            </div> -->
                                        </div>
                                    </div>
                                </form>
                            }
                        }
                        if (metalInCart.Count() > 0)
                        {
                            foreach (var metal in metalInCart)
                            {
                                <form asp-page-handler="" method="post">
                                    <div class="cart_3l1 clearfix">
                                        <div class="col-sm-3 space_left">
                                            @if (@metal.Name.Equals("gold"))
                                            {
                                                <div class="cart_3l1i clearfix">
                                                    <a href="#"><img src="~/img/gold.jpg" height="170px" alt="abc" class="iw"></a>
                                                </div>
                                            }
                                            @if (@metal.Name.Equals("silver"))
                                            {
                                                <div class="cart_3l1i clearfix">
                                                    <a href="#"><img src="~/img/silver.jpg" height="170px" alt="abc" class="iw"></a>
                                                </div>
                                            }
                                            @if (@metal.Name.Equals("palladium"))
                                            {
                                                <div class="cart_3l1i clearfix">
                                                    <a href="#"><img src="~/img/palladium.jpg" height="170px" alt="abc" class="iw"></a>
                                                </div>
                                            }
                                        </div>
                                        <div class="cart_3l1i1 clearfix">
                                            <h5 class="mgt">
                                                Name: @metal.Name
                                            </h5>
                                            <h4>Current Price: @metal.CurrentPrice.ToString("F2")</h4>
                                            <h4>Weight: @metal.Weight.ToString("F2") toz</h4>
                                            <h4>Sell Price: @metal.SellPrice.ToString("F2")</h4>
                                        </div>
                                    </div>
                                </form>
                            }
                        }
                    }
                    else
                    {
                        <p>You don't have any item to create now</p>
                    }
                }
            </div>
            <div class="col-sm-6">
                <div class="cart_3r clearfix">
                    <h5 class="mgt head_1">METAL at @Model.UpdatedDate.ToString()</h5>
                </div>
                <div class="feature_2 clearfix">
                    <div id="carousel-example" class="carousel slide" data-ride="carousel">
                        <!-- Wrapper for slides -->
                        <!-- Add metal to MetalCart -->
                        <div class="carousel-inner">
                            <div class="item active">
                                <form asp-page-handler="AddMetalToCart" method="post">
                                    <div class="col-sm-4">
                                        <div class="feature_2im clearfix">
                                            <div class="feature_2im1 clearfix">
                                                <img src="~/img/gold.jpg" width="200px" height="200px" class="iw" alt="Gold">
                                            </div>
                                            <div class="feature_2im4 clearfix">
                                                <div class="col-sm-6 space_left">
                                                    <h6><a class="bg_3" href="#">@Model.GoldBid</a></h6>
                                                </div>
                                                <div class="col-sm-6 feature_2im4r space_right">
                                                    <ul>
                                                        <li><button type="submit" name="Metal" value="gold" class="fa fa-shopping-cart" /></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <form asp-page-handler="AddMetalToCart" method="post">
                                    <div class="col-sm-4">
                                        <div class="feature_2im clearfix">
                                            <div class="feature_2im1 clearfix">
                                                <img src="~/img/silver.jpg" width="200px" height="200px" class="iw" alt="Silver">
                                            </div>
                                            <div class="feature_2im4 clearfix">
                                                <div class="col-sm-6 space_left">
                                                    <h6><a class="bg_3" href="#">@Model.SilverBid</a></h6>
                                                </div>
                                                <div class="col-sm-6 feature_2im4r space_right">
                                                    <ul>
                                                        <li><button type="submit" name="Metal" value="silver" class="fa fa-shopping-cart" /></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <form asp-page-handler="AddMetalToCart" method="post">
                                    <div class="col-sm-4">
                                        <div class="feature_2im clearfix">
                                            <div class="feature_2im1 clearfix">
                                                <img src="~/img/palladium.jpg" width="200px" height="200px" class="iw" alt="Palladium">
                                            </div>
                                            <div class="feature_2im4 clearfix">
                                                <div class="col-sm-6 space_left">
                                                    <h6><a class="bg_3" href="#">@Model.PalladiumBid</a></h6>
                                                </div>
                                                <div class="col-sm-6 feature_2im4r space_right">
                                                    <ul>
                                                        <li><button type="submit" name="Metal" value="palladium" class="fa fa-shopping-cart"></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="cart_3l clearfix">
                        <h5 class="mgt">GEM</h5>
                    </div>
                    <table class="table table-striped table-center">

                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Weight</th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var gem in Model.GemData)
                            {
                                <form asp-page-handler="AddMaterialToCart" method="post">
                                <tr class="d-flex justify-content-center">
                                    <td class="wrap-text">@gem.MaterialId</td>
                                    <td>@gem.Name</td>
                                    <td>@gem.Weight</td>
                                    <td>
                                        <img src="data:image/jpeg;base64,@Convert.ToBase64String(gem.MaterialImageData)" alt="@gem.Name" style="max-width: 100px; max-height: 100px;" />
                                    </td>
                                    <td>
                                        <a class="button" asp-page="/Gems/Detail" asp-route-id="@gem.MaterialId">Details</a>
                                    </td>
                                    <td>
                                        <input name="MaterialId" value="@gem.MaterialId" type="hidden" />
                                        <input name="MaterialImage" value="@Convert.ToBase64String(gem.MaterialImageData)" type="hidden" />
                                        <input name="MaterialPrice" value="@gem.SellPrice" type="hidden" />
                                        <input name="MaterialName" value="@gem.Name" type="hidden" />
                                        <input name="MaterialWeight" value="@gem.Weight" type="hidden" />
                                        <input value="Cart" type="submit" class="button" />
                                    </td>
                                </tr>
                                </form>
                            }
                        </tbody>
                    </table>
                    <div class="enquiry_1 text-center clearfix">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                                    <a class="button" asp-page="./Index" asp-route-currentPage="@(Model.CurrentPage - 1)">Previous</a>
                                </li>
                                @for (int i = 1; i <= Math.Ceiling((double)Model.TotalCount / Model.PageSize); i++)
                                {
                                    <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                                        <a class="button" style="background-color:#dfb858" asp-page="./Index" asp-route-currentPage="@i">@i</a>
                                    </li>
                                }
                                <li class="page-item @(Model.CurrentPage == Math.Ceiling((double)Model.TotalCount / Model.PageSize) ? "disabled" : "")">
                                    <a class="button" asp-page="./Index" asp-route-currentPage="@(Model.CurrentPage + 1)">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="post" enctype="multipart/form-data" asp-page-handler="CreateJewelry">
    <section id="checkout" class="clearfix">
        <div class="container">
            <div class="row">
                <div class="checkout_1 clearfix">
                    <div class="col-sm-6">
                        <div class="checkout_1l1 clearfix">
                            <div class="col-sm-4 space_left">
                                <h5>Jewelry ID <span class="col_1">*</span></h5>
                                <input asp-for="@Model.CreateJewelryRequest.JewelryId" class="form-control" type="text">
                            </div>
                            <div class="col-sm-4 space_left">
                                <h5>Jewelry Name <span class="col_1">*</span></h5>
                                <input asp-for="@Model.CreateJewelryRequest.JewelryName" class="form-control" type="tex">
                            </div>
                            <div class="col-sm-4 space_left">
                                <h5>Work Fee <span class="col_1">*</span></h5>
                                <input asp-for="@Model.CreateJewelryRequest.ManufacturingFees" class="form-control" type="number">
                            </div>
                        </div>
                        <div class="checkout_1l1 clearfix">
                            <div class="col-sm-6 space_left">
                                <h5>Clarity <span class="col_1">*</span></h5>
                                <select asp-for="@Model.CreateJewelryRequest.JewelryCategory" class="form-control" asp-items="Model.JewelryOptions"></select>
                            </div>
                            <div class="col-sm-6 space_left">
                                <h5>Warranty <span class="col_1">*</span></h5>
                                <input asp-for="@Model.CreateJewelryRequest.GuaranteeDuration" class="form-control" type="number">
                            </div>
                            <div class="checkout_1l1 clearfix">
                                <h4 class="mgt"><input class="button" type="submit" value="CREATE" /></h4>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="checkout_1l1 clearfix">
                            <h5>Jewelry Image <span class="col_1">*</span></h5>
                            <input asp-for="CreateJewelryRequest.JewelryImageFile" type="file" class="form-control" id="materialImageInput" accept="image/*">
                            <div class="mt-6" id="materialImagePreviewContainer">
                                <!-- Preview images will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</form>

<script>
    // Function to handle file input change and show preview
    function handleFileSelect(inputId, previewContainerId) {
        const input = document.getElementById(inputId);
        const previewContainer = document.getElementById(previewContainerId);

        input.addEventListener('change', function () {
            while (previewContainer.firstChild) {
                previewContainer.removeChild(previewContainer.firstChild);
            }

            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const imgElement = document.createElement('img');
                imgElement.setAttribute('src', e.target.result);
                imgElement.setAttribute('class', 'img-thumbnail');
                previewContainer.appendChild(imgElement);
            }

            reader.readAsDataURL(file);
        });
    }

    // Call handleFileSelect for each file input
    document.addEventListener('DOMContentLoaded', function () {
        handleFileSelect('materialImageInput', 'materialImagePreviewContainer');
    });
</script>